name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Auto restart every 6 hours

jobs:
  build:
    name: Start Building...
    runs-on: ubuntu-latest
    timeout-minutes: 350
    
    steps:
      - name: Direct Avica Setup
        run: |
          echo "ðŸš€ Starting Avica setup directly..."
          
          # Install dependencies
          sudo dpkg --add-architecture i386
          sudo apt-get update
          sudo apt-get install -y python3 python3-pip wine32 wine64 winetricks xvfb xfce4 xfce4-goodies xrdp
          
          # Setup Wine
          winetricks -q corefonts dotnet48 vcrun2019
          winecfg -v win10
          
          # Setup virtual display and XFCE
          Xvfb :99 -screen 0 1024x768x16 &
          export DISPLAY=:99
          startxfce4 &> xfce.log &
          sleep 5  # Wait for desktop to initialize
          
          # Download files
          wget -O setup.py https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py
          wget -O Avica_setup.exe https://download.avica.com/AvicaLite_v8.0.8.9.exe
          wget -O show.sh https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat
          wget -O loop.sh https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat
          chmod +x show.sh loop.sh
          
          # Install Python packages
          pip3 install requests pyautogui telegraph --quiet
          
          # Enable XRDP
          sudo systemctl enable xrdp
          sudo systemctl start xrdp
          
          # Set user password (using GitHub Secrets)
          sudo useradd -m -s /bin/bash runneradmin
          echo "runneradmin:${{ secrets.RUNNER_PASSWORD }}" | sudo chpasswd
          
          # Start Avica via Wine
          echo "âš¡ Starting Avica..."
          wine Avica_setup.exe &> avica_setup.log
          cat avica_setup.log
          
          # Run GUI interaction
          python3 -c "import pyautogui as pag; pag.click(897, 64, duration=2)" &> pyautogui.log
          cat pyautogui.log
          
          # Run setup script
          python3 setup.py &> setup.log
          cat setup.log
          
          echo "âœ… Setup completed! Check for GoFile link!"
          
      - name: Setup System User
        run: |
          echo "runneradmin:${{ secrets.RUNNER_PASSWORD }}" | sudo chpasswd
          echo "âœ… System user configured"
          
      - name: Show Connection Info
        run: |
          echo "
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘        AVICA RDP CONNECTION          â•‘  
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ðŸ“± Telegram : @TheNetworkZoneOfficial
          ðŸ‘¨â€ðŸ’» Credits : @PiroYadav & @TheYadavNetwork
          
          ðŸ“‹ Instructions:
          â€¢ Go to the GoFile link that will appear below
          â€¢ Get Avica ID and Password from there
          â€¢ Use XRDP (port 3389) or Avica app to connect
          â€¢ GoFile link changes every time!
          
          â³ Waiting for GoFile link...
          "
          
      - name: Start Avica Service
        run: |
          bash show.sh &> show.log
          cat show.log
          
      - name: Keep Session Active
        run: |
          echo "ðŸš€ Avica is starting... Look for CONNECTION ID below!"
          bash loop.sh &> loop.log
          cat loop.log
